<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/BlueHotDog/sails-migrations"

    >sails-migrations (v2.0.10)</a>
</h1>
<h4>The missing, migrations, arm of the octopus</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-migrations">module sails-migrations</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.createDatabase">
            function <span class="apidocSignatureSpan">sails-migrations.</span>createDatabase
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.currentVersion">
            function <span class="apidocSignatureSpan">sails-migrations.</span>currentVersion
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.database_tasks">
            function <span class="apidocSignatureSpan">sails-migrations.</span>database_tasks
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.dropDatabase">
            function <span class="apidocSignatureSpan">sails-migrations.</span>dropDatabase
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.generate">
            function <span class="apidocSignatureSpan">sails-migrations.</span>generate
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.migrate">
            function <span class="apidocSignatureSpan">sails-migrations.</span>migrate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.rollback">
            function <span class="apidocSignatureSpan">sails-migrations.</span>rollback
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_integration">
            function <span class="apidocSignatureSpan">sails-migrations.</span>sails_integration
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.status">
            function <span class="apidocSignatureSpan">sails-migrations.</span>status
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-migrations.</span>config_loader</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-migrations.</span>errors</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-migrations.</span>migrator_loader</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">sails-migrations.</span>sails_migrations</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-migrations.config_loader">module sails-migrations.config_loader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.config_loader.load">
            function <span class="apidocSignatureSpan">sails-migrations.config_loader.</span>load
            <span class="apidocSignatureSpan">(basePath)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-migrations.database_tasks">module sails-migrations.database_tasks</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.database_tasks.database_tasks">
            function <span class="apidocSignatureSpan">sails-migrations.</span>database_tasks
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.database_tasks.create">
            function <span class="apidocSignatureSpan">sails-migrations.database_tasks.</span>create
            <span class="apidocSignatureSpan">(config, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.database_tasks.drop">
            function <span class="apidocSignatureSpan">sails-migrations.database_tasks.</span>drop
            <span class="apidocSignatureSpan">(config, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.database_tasks.executeQuery">
            function <span class="apidocSignatureSpan">sails-migrations.database_tasks.</span>executeQuery
            <span class="apidocSignatureSpan">(config, query, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-migrations.errors">module sails-migrations.errors</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.errors.DatabaseAlreadyExists">
            function <span class="apidocSignatureSpan">sails-migrations.errors.</span>DatabaseAlreadyExists
            <span class="apidocSignatureSpan">(message, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.errors.MigrationsFolderDoesNotExists">
            function <span class="apidocSignatureSpan">sails-migrations.errors.</span>MigrationsFolderDoesNotExists
            <span class="apidocSignatureSpan">(message, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-migrations.migrator_loader">module sails-migrations.migrator_loader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.migrator_loader.load">
            function <span class="apidocSignatureSpan">sails-migrations.migrator_loader.</span>load
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-migrations.sails_integration">module sails-migrations.sails_integration</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_integration.sails_integration">
            function <span class="apidocSignatureSpan">sails-migrations.</span>sails_integration
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_integration.getSailsConfig">
            function <span class="apidocSignatureSpan">sails-migrations.sails_integration.</span>getSailsConfig
            <span class="apidocSignatureSpan">(modulesPath, sails)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_integration.loadSailsConfig">
            function <span class="apidocSignatureSpan">sails-migrations.sails_integration.</span>loadSailsConfig
            <span class="apidocSignatureSpan">(modulesPath, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.sails-migrations.sails_migrations">module sails-migrations.sails_migrations</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_migrations.createDatabase">
            function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>createDatabase
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_migrations.currentVersion">
            function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>currentVersion
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_migrations.dropDatabase">
            function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>dropDatabase
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_migrations.generate">
            function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>generate
            <span class="apidocSignatureSpan">(name, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_migrations.migrate">
            function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>migrate
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_migrations.rollback">
            function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>rollback
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.sails-migrations.sails_migrations.status">
            function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>status
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-migrations" id="apidoc.module.sails-migrations">module sails-migrations</a></h1>


    <h2>
        <a href="#apidoc.element.sails-migrations.createDatabase" id="apidoc.element.sails-migrations.createDatabase">
        function <span class="apidocSignatureSpan">sails-migrations.</span>createDatabase
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createDatabase() {
  return ConfigLoader.load().then(function(config){
    return Promise.promisify(databaseTasks.create)(config).then(function() {
      return config;
    })
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;db:create&#x27;)
  .description(&#x27;        Create the database&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">createDatabase</span>()
      .then(function (result) {
        exitSuccessfully(chalk.green(&#x27;successfully created database: &#x27; + chalk.blue(result.connection.database) + &#x27
; on host: &#x27; + chalk.blue(result.connection.host)));
      }).catch(exitWithError);
  });

commander
  .command(&#x27;db:drop&#x27;)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.currentVersion" id="apidoc.element.sails-migrations.currentVersion">
        function <span class="apidocSignatureSpan">sails-migrations.</span>currentVersion
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function currentVersion(){
  return ConfigLoader.load().then(function(config){
    return knex(config).migrate.currentVersion();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;current_version&#x27;)
  .description(&#x27;        View the current version for the migration.&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">currentVersion</span>()
      .then(function (version) {
        exitSuccessfully(chalk.green(&#x27;Current Version: &#x27;) + chalk.blue(version));
      }).catch(exitWithError);
  });


commander.parse(process.argv);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.database_tasks" id="apidoc.element.sails-migrations.database_tasks">
        function <span class="apidocSignatureSpan">sails-migrations.</span>database_tasks
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DatabaseTasks() {}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.dropDatabase" id="apidoc.element.sails-migrations.dropDatabase">
        function <span class="apidocSignatureSpan">sails-migrations.</span>dropDatabase
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function dropDatabase(){
  return ConfigLoader.load().then(function(config){
    return Promise.promisify(databaseTasks.drop)(config).then(function(config) {
      return config;
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;db:drop&#x27;)
  .description(&#x27;        Drops the database&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">dropDatabase</span>()
      .then(function (result) {
        exitSuccessfully(chalk.green(&#x27;successfully dropped database: &#x27; + chalk.blue(result.connection.database) + &#x27
; on host: &#x27; + chalk.blue(result.connection.host)))
      }).catch(exitWithError);
  });

commander
  .command(&#x27;status&#x27;)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.generate" id="apidoc.element.sails-migrations.generate">
        function <span class="apidocSignatureSpan">sails-migrations.</span>generate
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function generateMigration(name, options) {
  name = getMigrationName(name);
  return migratorLoader.load().then(function(migrator) {
    return migrator.make(name, options)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
commander
  .command(&#x27;generate &#x3c;name&#x3e;&#x27;)
  .description(&#x27;        Create a named migration file.&#x27;)
  .option(&#x27;-x [&#x27; + filetypes.join(&#x27;|&#x27;) + &#x27;]&#x27;, &#x27;Specify the stub extension (default js)&#x27;)
  .action(function (name) {
    var ext = (args.x || &#x27;js&#x27;).toLowerCase();
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">generate</span>(name, {extension: ext})
      .then(function (name) {
        exitSuccessfully(chalk.green(&#x27;Created Migration: &#x27; + name));
      }).catch(exitWithError);
  });

commander
  .command(&#x27;migrate&#x27;)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.migrate" id="apidoc.element.sails-migrations.migrate">
        function <span class="apidocSignatureSpan">sails-migrations.</span>migrate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function latest() {
  return migratorLoader.load().then(function(migrator) {
    var dbDir = path.resolve(migrator.config.directory);
    if (fs.existsSync(dbDir)) {
      return migrator.latest()
    } else {
      throw new errors.MigrationsFolderDoesNotExists(dbDir + &#x22; does not exists&#x22;, migrator.config);
    }
  })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;migrate&#x27;)
  .description(&#x27;        Run all migrations that have not yet been run.&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">migrate</span>()
      .spread(function (batchNo, log) {
        if (log.length === 0) {
          exitSuccessfully(chalk.cyan(&#x27;Already up to date&#x27;));
        }
        exitSuccessfully(chalk.green(&#x27;Batch &#x27; + batchNo + &#x27; run: &#x27; + log.length + &#x27; migrations \n&#x27; +
chalk.cyan(log.join(&#x27;\n&#x27;))));
      })
      .catch(exitWithError);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.rollback" id="apidoc.element.sails-migrations.rollback">
        function <span class="apidocSignatureSpan">sails-migrations.</span>rollback
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function rollback(){
  return ConfigLoader.load().then(function(config){
    return knex(config).migrate.rollback();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;rollback&#x27;)
  .description(&#x27;        Rollback the last set of migrations performed.&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">rollback</span>()
      .spread(function (batchNo, log) {
        if (log.length === 0) {
          exitSuccessfully(chalk.cyan(&#x27;Already at the base migration&#x27;));
        }
        exitSuccessfully(chalk.green(&#x27;Batch &#x27; + batchNo + &#x27; rolled back: &#x27; + log.length + &#x27; migrations \n&#x27;) + chalk.cyan(log.join(&#x27;\n&#x27;)));
      })
      .catch(exitWithError);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_integration" id="apidoc.element.sails-migrations.sails_integration">
        function <span class="apidocSignatureSpan">sails-migrations.</span>sails_integration
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SailsIntegration() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.status" id="apidoc.element.sails-migrations.status">
        function <span class="apidocSignatureSpan">sails-migrations.</span>status
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function status() {
  return ConfigLoader.load().then(function (config) {
    var knexInstance = knex(config);
    return knexInstance.schema.hasTable(config.migrations.tableName).then(function(exists) {
      if(exists) {
        return knexInstance.select(&#x27;*&#x27;).from(config.migrations.tableName).orderBy(&#x27;id&#x27;)
      } else {
        return []
      }
    }).then(function(completed) {
      return [knexInstance.migrate._listAll(), completed]
    })
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    });

  commander
    .command(&#x27;status&#x27;)
    .description(&#x27;        Nice status table to tickle your fancy&#x27;)
    .action(function () {
      pending = initSailsMigrations(env)
        .<span class="apidocCodeKeywordSpan">status</span>()
        .spread(function (all, completed) {
all = all || [];
var table = new Table({
  head: [chalk.blue.bold(&#x27;Migration name&#x27;), chalk.blue.bold(&#x27;Did run?&#x27;), chalk.blue.bold(&#x27;Batch no.&#x27
;)]
});

all.forEach(function (migrationName) {
...</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-migrations.config_loader" id="apidoc.module.sails-migrations.config_loader">module sails-migrations.config_loader</a></h1>


    <h2>
        <a href="#apidoc.element.sails-migrations.config_loader.load" id="apidoc.element.sails-migrations.config_loader.load">
        function <span class="apidocSignatureSpan">sails-migrations.config_loader.</span>load
        <span class="apidocSignatureSpan">(basePath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getConfig(basePath) {
  const modulesPath = getModulesPath(basePath);

  return Promise.promisify(SailsIntegration.loadSailsConfig)(modulesPath).then(getConfigFromSailsConfig);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

const databaseTasks = require(&#x27;./helpers/database_tasks.js&#x27;);
const Promise = require(&#x27;bluebird&#x27;);
const ConfigLoader = require(&#x27;./helpers/config_loader.js&#x27;);


function createDatabase() {
  return ConfigLoader.<span class="apidocCodeKeywordSpan">load</span>().then(function(config){
    return Promise.promisify(databaseTasks.create)(config).then(function() {
      return config;
    })
  })
}

module.exports = createDatabase;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-migrations.database_tasks" id="apidoc.module.sails-migrations.database_tasks">module sails-migrations.database_tasks</a></h1>


    <h2>
        <a href="#apidoc.element.sails-migrations.database_tasks.database_tasks" id="apidoc.element.sails-migrations.database_tasks.database_tasks">
        function <span class="apidocSignatureSpan">sails-migrations.</span>database_tasks
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DatabaseTasks() {}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.database_tasks.create" id="apidoc.element.sails-migrations.database_tasks.create">
        function <span class="apidocSignatureSpan">sails-migrations.database_tasks.</span>create
        <span class="apidocSignatureSpan">(config, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (config, cb) {
  var database = config.connection.database;

  DatabaseTasks.executeQuery(config, &#x22;CREATE DATABASE &#x22; + escapeIdentifier(config, database), function (err, stdout, stdin) {
    config.connection.database = database;
    if (err instanceof Error){
      cb(err, config);
    } else {
      cb(null, config);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.database_tasks.drop" id="apidoc.element.sails-migrations.database_tasks.drop">
        function <span class="apidocSignatureSpan">sails-migrations.database_tasks.</span>drop
        <span class="apidocSignatureSpan">(config, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">drop = function (config, cb) {
  var database = config.connection.database;
  DatabaseTasks.executeQuery(config, &#x22;DROP DATABASE &#x22; + escapeIdentifier(config, database), function (err, stdout, stdin) {
    config.connection.database = database;
    if (err instanceof Error){
      cb(err, config);
    } else {
      cb(null, config);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.database_tasks.executeQuery" id="apidoc.element.sails-migrations.database_tasks.executeQuery">
        function <span class="apidocSignatureSpan">sails-migrations.database_tasks.</span>executeQuery
        <span class="apidocSignatureSpan">(config, query, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">executeQuery = function (config, query, cb) {
  //config.debug = true;
  database = config.connection.database
  config.connection.database = clientToDefaultDbTable[config.client]; //bug in knex, if you pass a db, it will fail to drop/create
 a db :-(
  var knex = require(&#x27;knex&#x27;)(config);
  knex.raw(query).then(cb, cb)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *   user: db user
 *   password: db connection password
 *   host: db host
 * */
DatabaseTasks.create = function (config, cb) {
var database = config.connection.database;

DatabaseTasks.<span class="apidocCodeKeywordSpan">executeQuery</span>(config, &#x22;CREATE DATABASE &#x22; + escapeIdentifier(config
, database), function (err, stdout, stdin) {
  config.connection.database = database;
  if (err instanceof Error){
    cb(err, config);
  } else {
    cb(null, config);
  }
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-migrations.errors" id="apidoc.module.sails-migrations.errors">module sails-migrations.errors</a></h1>


    <h2>
        <a href="#apidoc.element.sails-migrations.errors.DatabaseAlreadyExists" id="apidoc.element.sails-migrations.errors.DatabaseAlreadyExists">
        function <span class="apidocSignatureSpan">sails-migrations.errors.</span>DatabaseAlreadyExists
        <span class="apidocSignatureSpan">(message, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DatabaseAlreadyExists(message, config) {
  Error.call(this);
  Error.captureStackTrace(this, arguments.callee);
  this.message = message;
  this.config = config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.errors.MigrationsFolderDoesNotExists" id="apidoc.element.sails-migrations.errors.MigrationsFolderDoesNotExists">
        function <span class="apidocSignatureSpan">sails-migrations.errors.</span>MigrationsFolderDoesNotExists
        <span class="apidocSignatureSpan">(message, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MigrationsFolderDoesNotExists(message, config) {
  Error.call(this);
  Error.captureStackTrace(this, arguments.callee);
  this.message = message;
  this.config = config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

function latest() {
  return migratorLoader.load().then(function(migrator) {
    var dbDir = path.resolve(migrator.config.directory);
    if (fs.existsSync(dbDir)) {
      return migrator.latest()
    } else {
      throw new errors.<span class="apidocCodeKeywordSpan">MigrationsFolderDoesNotExists</span>(dbDir + &#x22; does not exists&#
x22;, migrator.config);
    }
  })

}
module.exports = latest;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-migrations.migrator_loader" id="apidoc.module.sails-migrations.migrator_loader">module sails-migrations.migrator_loader</a></h1>


    <h2>
        <a href="#apidoc.element.sails-migrations.migrator_loader.load" id="apidoc.element.sails-migrations.migrator_loader.load">
        function <span class="apidocSignatureSpan">sails-migrations.migrator_loader.</span>load
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function load() {
  return configLoader.load().then(function(config) {
    //probably a good idea to wrap this with something to abstract knex
    return knex(config).migrate;
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

const databaseTasks = require(&#x27;./helpers/database_tasks.js&#x27;);
const Promise = require(&#x27;bluebird&#x27;);
const ConfigLoader = require(&#x27;./helpers/config_loader.js&#x27;);


function createDatabase() {
  return ConfigLoader.<span class="apidocCodeKeywordSpan">load</span>().then(function(config){
    return Promise.promisify(databaseTasks.create)(config).then(function() {
      return config;
    })
  })
}

module.exports = createDatabase;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-migrations.sails_integration" id="apidoc.module.sails-migrations.sails_integration">module sails-migrations.sails_integration</a></h1>


    <h2>
        <a href="#apidoc.element.sails-migrations.sails_integration.sails_integration" id="apidoc.element.sails-migrations.sails_integration.sails_integration">
        function <span class="apidocSignatureSpan">sails-migrations.</span>sails_integration
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SailsIntegration() {
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_integration.getSailsConfig" id="apidoc.element.sails-migrations.sails_integration.getSailsConfig">
        function <span class="apidocSignatureSpan">sails-migrations.sails_integration.</span>getSailsConfig
        <span class="apidocSignatureSpan">(modulesPath, sails)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getSailsConfig = function (modulesPath, sails) {
  var adapter, dbConfig, defaultAdapterName, moduleName;
  const sailsVersion = getSailsVersion(sails);
  switch (true) {
    case sailsVersion === &#x22;0.9&#x22;:
      defaultAdapterName = sails.config.adapters[&#x22;default&#x22;];
      dbConfig = sails.config.adapters[defaultAdapterName];
      moduleName = dbConfig.module;
      break;
    case _.contains([&#x22;0.10&#x22;, &#x22;0.11&#x22;, &#x22;0.12&#x22;], sailsVersion):
      defaultAdapterName = sails.config.models.connection;
      dbConfig = sails.config.connections[defaultAdapterName];
      moduleName = dbConfig.adapter;
  }
  adapter = require(path.join(modulesPath, moduleName));
  adapter.config = dbConfig;
  adapter.version = sailsVersion;

  return {
    migrationLibPath:   __dirname,
    defaultAdapterName: defaultAdapterName,
    defaultAdapter:     adapter,
    sailsPath:          sailsPath(modulesPath)
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  loadHooks: [&#x27;moduleloader&#x27;, &#x27;userconfig&#x27;],
  appPath:   path.join(modulesPath, &#x22;..&#x22;)
});

sails = require(sailsPathStr);
return sails.load(options, function (err) {
  if (err) { return cb(err); }
  cache = SailsIntegration.<span class="apidocCodeKeywordSpan">getSailsConfig</span>(modulesPath, sails);
  return cb(null, cache);
});
};

SailsIntegration.getSailsConfig = function (modulesPath, sails) {
var adapter, dbConfig, defaultAdapterName, moduleName;
const sailsVersion = getSailsVersion(sails);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_integration.loadSailsConfig" id="apidoc.element.sails-migrations.sails_integration.loadSailsConfig">
        function <span class="apidocSignatureSpan">sails-migrations.sails_integration.</span>loadSailsConfig
        <span class="apidocSignatureSpan">(modulesPath, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadSailsConfig = function (modulesPath, cb) {
  var options, sails;

  if (cache) { return cb(null, cache); }

  var sailsPathStr = sailsPath(modulesPath);
  var sailsPackage = require(path.join(sailsPathStr,&#x27;package&#x27;));

  var rconf;
  try {
    rconf = require(path.join(sailsPathStr,&#x27;/lib/app/configuration/rc&#x27;));
  }
  catch(e) {
    // If rc does not exist then set to empty object
    rconf = {};
  }

  options = _.merge(rconf,{
    globals:   false,
    loadHooks: [&#x27;moduleloader&#x27;, &#x27;userconfig&#x27;],
    appPath:   path.join(modulesPath, &#x22;..&#x22;)
  });

  sails = require(sailsPathStr);
  return sails.load(options, function (err) {
    if (err) { return cb(err); }
    cache = SailsIntegration.getSailsConfig(modulesPath, sails);
    return cb(null, cache);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.sails-migrations.sails_migrations" id="apidoc.module.sails-migrations.sails_migrations">module sails-migrations.sails_migrations</a></h1>


    <h2>
        <a href="#apidoc.element.sails-migrations.sails_migrations.createDatabase" id="apidoc.element.sails-migrations.sails_migrations.createDatabase">
        function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>createDatabase
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createDatabase() {
  return ConfigLoader.load().then(function(config){
    return Promise.promisify(databaseTasks.create)(config).then(function() {
      return config;
    })
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;db:create&#x27;)
  .description(&#x27;        Create the database&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">createDatabase</span>()
      .then(function (result) {
        exitSuccessfully(chalk.green(&#x27;successfully created database: &#x27; + chalk.blue(result.connection.database) + &#x27
; on host: &#x27; + chalk.blue(result.connection.host)));
      }).catch(exitWithError);
  });

commander
  .command(&#x27;db:drop&#x27;)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_migrations.currentVersion" id="apidoc.element.sails-migrations.sails_migrations.currentVersion">
        function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>currentVersion
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function currentVersion(){
  return ConfigLoader.load().then(function(config){
    return knex(config).migrate.currentVersion();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;current_version&#x27;)
  .description(&#x27;        View the current version for the migration.&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">currentVersion</span>()
      .then(function (version) {
        exitSuccessfully(chalk.green(&#x27;Current Version: &#x27;) + chalk.blue(version));
      }).catch(exitWithError);
  });


commander.parse(process.argv);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_migrations.dropDatabase" id="apidoc.element.sails-migrations.sails_migrations.dropDatabase">
        function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>dropDatabase
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function dropDatabase(){
  return ConfigLoader.load().then(function(config){
    return Promise.promisify(databaseTasks.drop)(config).then(function(config) {
      return config;
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;db:drop&#x27;)
  .description(&#x27;        Drops the database&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">dropDatabase</span>()
      .then(function (result) {
        exitSuccessfully(chalk.green(&#x27;successfully dropped database: &#x27; + chalk.blue(result.connection.database) + &#x27
; on host: &#x27; + chalk.blue(result.connection.host)))
      }).catch(exitWithError);
  });

commander
  .command(&#x27;status&#x27;)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_migrations.generate" id="apidoc.element.sails-migrations.sails_migrations.generate">
        function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>generate
        <span class="apidocSignatureSpan">(name, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function generateMigration(name, options) {
  name = getMigrationName(name);
  return migratorLoader.load().then(function(migrator) {
    return migrator.make(name, options)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
commander
  .command(&#x27;generate &#x3c;name&#x3e;&#x27;)
  .description(&#x27;        Create a named migration file.&#x27;)
  .option(&#x27;-x [&#x27; + filetypes.join(&#x27;|&#x27;) + &#x27;]&#x27;, &#x27;Specify the stub extension (default js)&#x27;)
  .action(function (name) {
    var ext = (args.x || &#x27;js&#x27;).toLowerCase();
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">generate</span>(name, {extension: ext})
      .then(function (name) {
        exitSuccessfully(chalk.green(&#x27;Created Migration: &#x27; + name));
      }).catch(exitWithError);
  });

commander
  .command(&#x27;migrate&#x27;)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_migrations.migrate" id="apidoc.element.sails-migrations.sails_migrations.migrate">
        function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>migrate
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function latest() {
  return migratorLoader.load().then(function(migrator) {
    var dbDir = path.resolve(migrator.config.directory);
    if (fs.existsSync(dbDir)) {
      return migrator.latest()
    } else {
      throw new errors.MigrationsFolderDoesNotExists(dbDir + &#x22; does not exists&#x22;, migrator.config);
    }
  })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;migrate&#x27;)
  .description(&#x27;        Run all migrations that have not yet been run.&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">migrate</span>()
      .spread(function (batchNo, log) {
        if (log.length === 0) {
          exitSuccessfully(chalk.cyan(&#x27;Already up to date&#x27;));
        }
        exitSuccessfully(chalk.green(&#x27;Batch &#x27; + batchNo + &#x27; run: &#x27; + log.length + &#x27; migrations \n&#x27; +
chalk.cyan(log.join(&#x27;\n&#x27;))));
      })
      .catch(exitWithError);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_migrations.rollback" id="apidoc.element.sails-migrations.sails_migrations.rollback">
        function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>rollback
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function rollback(){
  return ConfigLoader.load().then(function(config){
    return knex(config).migrate.rollback();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });

commander
  .command(&#x27;rollback&#x27;)
  .description(&#x27;        Rollback the last set of migrations performed.&#x27;)
  .action(function () {
    pending = initSailsMigrations(env)
      .<span class="apidocCodeKeywordSpan">rollback</span>()
      .spread(function (batchNo, log) {
        if (log.length === 0) {
          exitSuccessfully(chalk.cyan(&#x27;Already at the base migration&#x27;));
        }
        exitSuccessfully(chalk.green(&#x27;Batch &#x27; + batchNo + &#x27; rolled back: &#x27; + log.length + &#x27; migrations \n&#x27;) + chalk.cyan(log.join(&#x27;\n&#x27;)));
      })
      .catch(exitWithError);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.sails-migrations.sails_migrations.status" id="apidoc.element.sails-migrations.sails_migrations.status">
        function <span class="apidocSignatureSpan">sails-migrations.sails_migrations.</span>status
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function status() {
  return ConfigLoader.load().then(function (config) {
    var knexInstance = knex(config);
    return knexInstance.schema.hasTable(config.migrations.tableName).then(function(exists) {
      if(exists) {
        return knexInstance.select(&#x27;*&#x27;).from(config.migrations.tableName).orderBy(&#x27;id&#x27;)
      } else {
        return []
      }
    }).then(function(completed) {
      return [knexInstance.migrate._listAll(), completed]
    })
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    });

  commander
    .command(&#x27;status&#x27;)
    .description(&#x27;        Nice status table to tickle your fancy&#x27;)
    .action(function () {
      pending = initSailsMigrations(env)
        .<span class="apidocCodeKeywordSpan">status</span>()
        .spread(function (all, completed) {
all = all || [];
var table = new Table({
  head: [chalk.blue.bold(&#x27;Migration name&#x27;), chalk.blue.bold(&#x27;Did run?&#x27;), chalk.blue.bold(&#x27;Batch no.&#x27
;)]
});

all.forEach(function (migrationName) {
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
